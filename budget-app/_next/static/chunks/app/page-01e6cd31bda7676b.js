(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5016:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>ef});var a=s(5155),n=s(2115),r=s(6740),i=s(2417),l=s(4229),o=s(7434),m=s(5112),c=s(1788),d=s(9869),u=s(133),g=s(3227),p=s(7580),h=s(5868),x=s(9074),b=s(3109);let y="ctaBudget",v="ctaBudget_backup",f={studyInfo:{protocolNumber:"",studyTitle:"",piName:"",studyDate:"",sponsor:"",siteName:""},startupFees:[{id:"1",name:"IRB Fee",amount:0,timing:"oneTime"},{id:"2",name:"Ethics Committee Fee",amount:0,timing:"oneTime"},{id:"3",name:"Archiving Fee",amount:0,timing:"oneTime"},{id:"4",name:"Pharmacy Fee",amount:0,timing:"oneTime"}],visits:[],overhead:30,customRevenueItems:[],targetEnrollment:0,personnelReimbursements:[],notes:""},N=e=>!!e&&"object"==typeof e&&!!["startupFees","visits","customRevenueItems","personnelReimbursements"].every(t=>t in e)&&!!Array.isArray(e.startupFees)&&!!Array.isArray(e.visits)&&!!Array.isArray(e.customRevenueItems)&&!!Array.isArray(e.personnelReimbursements)&&"number"==typeof e.overhead&&!(e.overhead<0)&&"number"==typeof e.targetEnrollment&&!(e.targetEnrollment<0)&&!0,j=e=>{if(e.startupFees&&!Array.isArray(e.startupFees)){let t=e.startupFees;e.startupFees=[{id:"1",name:"IRB Fee",amount:t.irbFee||0,timing:"oneTime"},{id:"2",name:"Ethics Committee Fee",amount:t.ethicsCommitteeFee||0,timing:"oneTime"},{id:"3",name:"Archiving Fee",amount:t.archivingFee||0,timing:"oneTime"},{id:"4",name:"Pharmacy Fee",amount:t.pharmacyFee||0,timing:"oneTime"}]}return e.personnelCosts&&!e.personnelReimbursements&&(e.personnelReimbursements=e.personnelCosts,delete e.personnelCosts),e.studyInfo||(e.studyInfo={protocolNumber:"",studyTitle:"",piName:"",studyDate:"",sponsor:"",siteName:""}),e.startupFees=Array.isArray(e.startupFees)?e.startupFees:f.startupFees,e.visits=Array.isArray(e.visits)?e.visits:[],e.customRevenueItems=Array.isArray(e.customRevenueItems)?e.customRevenueItems:[],e.personnelReimbursements=Array.isArray(e.personnelReimbursements)?e.personnelReimbursements:[],e.overhead="number"==typeof e.overhead?e.overhead:30,e.targetEnrollment="number"==typeof e.targetEnrollment?e.targetEnrollment:0,e.notes="string"==typeof e.notes?e.notes:"",e.startupFees&&(e.startupFees=e.startupFees.map(e=>({...e,timing:e.timing||"oneTime",estimatedOccurrences:e.estimatedOccurrences||void 0}))),e.customRevenueItems&&(e.customRevenueItems=e.customRevenueItems.map(e=>({...e,timing:e.timing||"oneTime",estimatedOccurrences:e.estimatedOccurrences||void 0}))),e},w=()=>{try{let e,t=localStorage.getItem(y);if(!t)return{data:f};try{e=JSON.parse(t)}catch(s){let t=localStorage.getItem(v);if(!t)return{data:f,error:{type:"PARSE_ERROR",message:"Stored data is corrupted and no backup exists",originalError:s}};try{e=JSON.parse(t),console.warn("Loaded from backup due to corrupted main data")}catch(e){return{data:f,error:{type:"PARSE_ERROR",message:"Both main and backup data are corrupted",originalError:s}}}}let s=j(e);if(!N(s))return{data:f,error:{type:"INVALID_DATA",message:"Stored data failed validation checks"}};return{data:s}}catch(e){return{data:f,error:{type:"UNKNOWN",message:"Unexpected error loading budget data",originalError:e}}}},S=e=>{let t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download="cta-budget-".concat(new Date().toISOString().split("T")[0],".json"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)};var I=s(6597);s(2699);let R=async(e,t)=>{let s=new I.Ay("p","mm","a4"),a=s.internal.pageSize.getWidth(),n=s.internal.pageSize.getHeight(),r=20;s.setFontSize(20),s.setFont("helvetica","bold"),s.text("Clinical Trial Budget Report",20,r),r+=15,s.setFontSize(14),s.text("Study Information",20,r),r+=8,s.setFontSize(10),s.setFont("helvetica","normal"),[["Protocol Number:",e.studyInfo.protocolNumber||"Not specified"],["Study Title:",e.studyInfo.studyTitle||"Not specified"],["Principal Investigator:",e.studyInfo.piName||"Not specified"],["Study Date:",e.studyInfo.studyDate||"Not specified"],["Sponsor:",e.studyInfo.sponsor||"Not specified"],["Site Name:",e.studyInfo.siteName||"Not specified"]].forEach(e=>{let[t,a]=e;s.text(t,20,r),s.text(a,60,r),r+=5}),r+=10,s.setFontSize(14),s.setFont("helvetica","bold"),s.text("Study Parameters",20,r),r+=8,s.setFontSize(10),s.setFont("helvetica","normal"),s.text("Target Enrollment: ".concat(e.targetEnrollment," patients"),20,r),r+=5,s.text("Overhead Rate: ".concat(e.overhead,"%"),20,r),r+=15,s.setFontSize(14),s.setFont("helvetica","bold"),s.text("Budget Summary",20,r),r+=8,s.setFontSize(10),s.setFont("helvetica","normal");let i=[["Startup Fees",t.totalStartupFees],["Visit Revenue",t.totalVisitRevenue],["Custom Revenue",t.totalCustomRevenue],["Personnel Reimbursements",t.totalPersonnelReimbursements],["Subtotal",t.subtotal],["Overhead (".concat(e.overhead,"%)"),t.overheadAmount],["Total Budget Request",t.totalRevenue]];if(i.forEach((e,t)=>{let[n,l]=e,o=t===i.length-1;("Subtotal"===n||"string"==typeof n&&n.includes("Overhead"))&&(r+=2,s.line(20,r,a-20,r),r+=3),o?(s.setFont("helvetica","bold"),s.setFontSize(12)):(s.setFont("helvetica","normal"),s.setFontSize(10)),s.text(String(n),20,r),s.text("$".concat(l.toLocaleString()),a-20-30,r,{align:"right"}),r+=o?8:5}),r+=10,e.targetEnrollment>0){let a=t.totalRevenue/e.targetEnrollment;s.setFontSize(10),s.setFont("helvetica","italic"),s.text("Budget Per Patient: $".concat(a.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),20,r),r+=10}if(r>n-50&&(s.addPage(),r=20),e.startupFees.length>0&&(s.setFontSize(14),s.setFont("helvetica","bold"),s.text("Startup Fees Detail",20,r),r+=8,e.startupFees.forEach(e=>{s.setFontSize(10),s.setFont("helvetica","normal"),s.text(e.name,20,r),s.text("$".concat(e.amount.toLocaleString()),a-20-30,r,{align:"right"}),r+=5}),r+=5),e.visits.length>0&&(r>n-30&&(s.addPage(),r=20),s.setFontSize(14),s.setFont("helvetica","bold"),s.text("Visit Schedule Detail",20,r),r+=8,e.visits.forEach(t=>{s.setFontSize(10),s.setFont("helvetica","normal");let n=t.paymentPerVisit*e.targetEnrollment;s.text("".concat(t.name," ($").concat(t.paymentPerVisit.toLocaleString(),"/visit)"),20,r),s.text("$".concat(n.toLocaleString()),a-20-30,r,{align:"right"}),r+=5}),r+=5),e.notes.trim()){r>n-40&&(s.addPage(),r=20),s.setFontSize(14),s.setFont("helvetica","bold"),s.text("Notes",20,r),r+=8,s.setFontSize(10),s.setFont("helvetica","normal");let t=s.splitTextToSize(e.notes,a-40);s.text(t,20,r)}let l=new Date;s.setFontSize(8),s.setFont("helvetica","italic"),s.text("Generated on ".concat(l.toLocaleDateString()," at ").concat(l.toLocaleTimeString()),20,n-10);let o=e.studyInfo.protocolNumber?"budget_".concat(e.studyInfo.protocolNumber,"_").concat(l.toISOString().split("T")[0],".pdf"):"clinical_trial_budget_".concat(l.toISOString().split("T")[0],".pdf");s.save(o)},F=async(e,t)=>{let s=[],a=(e,t)=>{s.push(e)};a(["Clinical Trial Budget Report"],"header"),a(["Generated: ".concat(new Date().toLocaleDateString())]),a([]),a(["Study Information"],"section-header"),a(["Field","Value"],"table-header"),a(["Protocol Number",e.studyInfo.protocolNumber||"Not specified"]),a(["Study Title",e.studyInfo.studyTitle||"Not specified"]),a(["Principal Investigator",e.studyInfo.piName||"Not specified"]),a(["Study Date",e.studyInfo.studyDate||"Not specified"]),a(["Sponsor",e.studyInfo.sponsor||"Not specified"]),a(["Site Name",e.studyInfo.siteName||"Not specified"]),a(["Target Enrollment",e.targetEnrollment]),a(["Overhead Rate","".concat(e.overhead,"%")]),a([]),a(["Budget Summary"],"section-header"),a(["Category","Amount (USD)"],"table-header"),a(["Startup Fees",t.totalStartupFees]),a(["Visit Revenue",t.totalVisitRevenue]),a(["Custom Revenue",t.totalCustomRevenue]),a(["Personnel Reimbursements",t.totalPersonnelReimbursements]),a(["Subtotal",t.subtotal]),a(["Overhead (".concat(e.overhead,"%)"),t.overheadAmount]),a(["TOTAL BUDGET REQUEST",t.totalRevenue],"total"),e.targetEnrollment>0&&a(["Budget Per Patient",t.totalRevenue/e.targetEnrollment]),a([]),e.startupFees.length>0&&(a(["Startup Fees Details"],"section-header"),a(["Item","Amount (USD)"],"table-header"),e.startupFees.forEach(e=>{a([e.name,e.amount])}),a([])),e.visits.length>0&&(a(["Visit Schedule Details"],"section-header"),a(["Visit","Per Visit Payment","Total for Target Enrollment"],"table-header"),e.visits.forEach(t=>{let s=t.paymentPerVisit*e.targetEnrollment;a([t.name,t.paymentPerVisit,s])}),a([]));let n=new Blob(["\uFEFF"+s.map(e=>e.map(e=>{let t=String(e||"");return t.includes(",")||t.includes('"')||t.includes("\n")?'"'.concat(t.replace(/"/g,'""'),'"'):t}).join(",")).join("\n")],{type:"application/vnd.ms-excel;charset=utf-8;"}),r=document.createElement("a"),i=e.studyInfo.protocolNumber?"budget_".concat(e.studyInfo.protocolNumber,"_").concat(new Date().toISOString().split("T")[0],".csv"):"clinical_trial_budget_".concat(new Date().toISOString().split("T")[0],".csv");if(void 0!==r.download){let e=URL.createObjectURL(n);r.setAttribute("href",e),r.setAttribute("download",i),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(e)}};var C=s(4616),P=s(2525),E=s(5604),A=s(5339),T=s(646);let k=E.ai().min(0,"Amount must be non-negative").max(0x5f5e0ff,"Amount is too large").finite("Amount must be a valid number"),D=E.Yj().min(1,"Name is required").max(200,"Name is too long").trim(),O=E.Yj().max(500,"Text is too long").trim(),V=E.Ik({id:E.Yj().min(1,"ID is required"),name:D,amount:k}),M=E.Ik({protocolNumber:O,studyTitle:O,piName:O,studyDate:O,sponsor:O,siteName:O}),B=E.Ik({id:E.Yj().min(1,"ID is required"),name:D,paymentPerVisit:k}),L=E.Ik({id:E.Yj().min(1,"ID is required"),name:D,amount:k,type:E.k5(["flat","perPatient","perVisit"])}),_=E.Ik({id:E.Yj().min(1,"ID is required"),role:D,type:E.k5(["perPatient","flatMonthly"]),hourlyRate:E.ai().min(0).max(9999).optional(),hours:E.ai().min(0).max(9999).optional(),monthlyFee:E.ai().min(0).max(999999).optional(),months:E.ai().min(0).max(999).optional()}).refine(e=>"perPatient"===e.type?"number"==typeof e.hourlyRate&&"number"==typeof e.hours:"flatMonthly"!==e.type||"number"==typeof e.monthlyFee&&"number"==typeof e.months,{message:"Per patient entries require hourly rate and hours. Monthly entries require monthly fee and months."});E.Ik({studyInfo:M,startupFees:E.YO(V).max(50,"Too many startup fees"),visits:E.YO(B).max(100,"Too many visits"),overhead:E.ai().min(0,"Overhead must be non-negative").max(100,"Overhead cannot exceed 100%"),customRevenueItems:E.YO(L).max(100,"Too many custom revenue items"),targetEnrollment:E.ai().min(0,"Target enrollment must be non-negative").max(99999,"Target enrollment is too large").int("Target enrollment must be a whole number"),personnelReimbursements:E.YO(_).max(50,"Too many personnel reimbursements"),notes:E.Yj().max(5e3,"Notes are too long")});let U=e=>e.success?[]:e.error.issues.map(e=>({path:e.path.join("."),message:e.message})),z=()=>{let[e,t]=(0,n.useState)({}),s=(0,n.useCallback)((e,s,a)=>{let n=a.safeParse(s),r=U(n),i={isValid:n.success,errors:r,hasError:e=>r.some(t=>t.path===e||t.path.startsWith("".concat(e,"."))),getError:e=>{var t;return null==(t=r.find(t=>t.path===e))?void 0:t.message}};return t(t=>({...t,[e]:i})),i},[]),a=(0,n.useCallback)(e=>{let s={},a=!0;return e.forEach(e=>{let{fieldName:t,value:n,schema:r}=e,i=r.safeParse(n),l=U(i),o={isValid:i.success,errors:l,hasError:e=>l.some(t=>t.path===e||t.path.startsWith("".concat(e,"."))),getError:e=>{var t;return null==(t=l.find(t=>t.path===e))?void 0:t.message}};s[t]=o,i.success||(a=!1)}),t(e=>({...e,...s})),{allValid:a,states:s}},[]),r=(0,n.useCallback)(e=>{e?t(t=>{let s={...t};return delete s[e],s}):t({})},[]);return{validateField:s,validateMultipleFields:a,clearValidation:r,getFieldValidation:(0,n.useCallback)(t=>e[t],[e]),isFormValid:(0,n.useCallback)(t=>t.every(t=>{let s=e[t];return!s||s.isValid}),[e]),validationState:e}},$=e=>{let{type:t="text",placeholder:s,value:r,onChange:i,onFocus:l,className:o="",schema:m,fieldName:c,debounceMs:d=300,showSuccess:u=!1}=e,{validateField:g,getFieldValidation:p}=z(),[h,x]=(0,n.useState)(r),[b,y]=(0,n.useState)(null),v=p(c),f=v&&!v.isValid,N=v&&v.isValid;(0,n.useEffect)(()=>{"number"===t&&(0===r||null==r||Number.isNaN(r))?x(""):x(r)},[r,t]),(0,n.useEffect)(()=>()=>{b&&clearTimeout(b)},[b]);let j="".concat("px-3 py-2 bg-white border rounded-lg focus:ring-2 focus:ring-blue-500 text-gray-900 text-sm transition-colors"," ").concat((f?"border-red-300 focus:border-red-500":"")||(N&&u?"border-green-300 focus:border-green-500":"border-gray-300 focus:border-blue-500")," ").concat(o);return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{type:t,placeholder:s,value:h,onChange:e=>{let s=e.target.value;"number"===t&&s.length>1&&s.startsWith("0")&&!s.startsWith("0.")&&(s=s.replace(/^0+/,"")||"0"),x(s),b&&clearTimeout(b),y(setTimeout(()=>{let e="number"===t?""===s?0:Number(s):s;g(c,e,m),i(e)},d))},onBlur:()=>{b&&clearTimeout(b);let e="number"===t?""===h?0:Number(h):h;g(c,e,m),i(e)},onFocus:e=>{"number"===t&&e.target.select(),l&&l(e)},className:j}),(f||N&&u)&&(0,a.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:f?(0,a.jsx)(A.A,{className:"h-4 w-4 text-red-500"}):(0,a.jsx)(T.A,{className:"h-4 w-4 text-green-500"})})]}),f&&v.errors.length>0&&(0,a.jsx)("div",{className:"mt-1 text-sm text-red-600",children:v.errors[0].message})]})},J=e=>{let{value:t,onChange:s,options:n,className:r="",schema:i,fieldName:l}=e,{validateField:o,getFieldValidation:m}=z(),c=m(l),d=c&&!c.isValid,u="".concat("px-3 py-2 bg-white border rounded-lg focus:ring-2 focus:ring-blue-500 text-gray-900 text-sm"," ").concat(d?"border-red-300 focus:border-red-500":"border-gray-300 focus:border-blue-500"," ").concat(r);return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("select",{value:t,onChange:e=>{let t=e.target.value;o(l,t,i),s(t)},className:u,children:n.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))}),d&&c.errors.length>0&&(0,a.jsx)("div",{className:"mt-1 text-sm text-red-600",children:c.errors[0].message})]})},W=E.Yj().min(1,"Name is required").max(200,"Name is too long").trim(),q=E.ai().min(0,"Amount must be non-negative").max(0x5f5e0ff,"Amount is too large").finite("Amount must be a valid number"),Y=E.k5(["oneTime","perVisit","asNeeded"]),K=E.ai().min(1,"Must be at least 1").max(999,"Too many occurrences"),Q=e=>{let{title:t,items:s,onAdd:n,onUpdate:r,onDelete:i,icon:l,category:o}=e;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-gray-100 rounded-lg",children:(0,a.jsx)(l,{className:"w-5 h-5 text-gray-700"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:t})]}),(0,a.jsxs)("button",{onClick:n,className:"flex items-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:[(0,a.jsx)(C.A,{className:"w-4 h-4"}),"Add Item"]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[s.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200",children:["startupFees"===o?(0,a.jsx)(H,{item:e,onUpdate:r}):"visits"===o?(0,a.jsx)(G,{item:e,onUpdate:r}):"customRevenue"===o?(0,a.jsx)(Z,{item:e,onUpdate:r}):"personnelReimbursements"===o?(0,a.jsx)(er,{item:e,onUpdate:r}):null,(0,a.jsx)("button",{onClick:()=>i(e.id),className:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors",children:(0,a.jsx)(P.A,{className:"w-4 h-4"})})]},e.id||t)),0===s.length&&(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)("div",{className:"text-sm",children:"No items added yet"}),(0,a.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:'Click "Add Item" to get started'})]})]})]})},H=e=>{let{item:t,onUpdate:s}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($,{type:"text",placeholder:"Fee Name",value:t.name,onChange:e=>s(t.id,{name:e}),className:"flex-1",schema:W,fieldName:"startupFee-".concat(t.id,"-name")}),(0,a.jsx)(J,{value:t.timing,onChange:e=>s(t.id,{timing:e,estimatedOccurrences:"asNeeded"===e?1:void 0}),options:[{value:"oneTime",label:"One-time"},{value:"perVisit",label:"Per Visit"},{value:"asNeeded",label:"As Needed"}],schema:Y,fieldName:"startupFee-".concat(t.id,"-timing")}),"asNeeded"===t.timing&&(0,a.jsx)($,{type:"number",placeholder:"Occurrences",value:t.estimatedOccurrences||1,onChange:e=>s(t.id,{estimatedOccurrences:Number(e)}),onFocus:e=>e.target.select(),className:"w-20",schema:K,fieldName:"startupFee-".concat(t.id,"-occurrences"),showSuccess:!0}),(0,a.jsx)($,{type:"number",placeholder:"Amount",value:t.amount,onChange:e=>s(t.id,{amount:Number(e)}),onFocus:e=>e.target.select(),className:"w-24",schema:q,fieldName:"startupFee-".concat(t.id,"-amount"),showSuccess:!0}),(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat("oneTime"===t.timing?"bg-blue-100 text-blue-800":"perVisit"===t.timing?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"),children:"oneTime"===t.timing?"One-time":"perVisit"===t.timing?"Per Visit":"As Needed (".concat(t.estimatedOccurrences||1,"x)")})})]})},G=e=>{let{item:t,onUpdate:s}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($,{type:"text",placeholder:"Visit Name",value:t.name,onChange:e=>s(t.id,{name:e}),className:"flex-1",schema:W,fieldName:"visit-".concat(t.id,"-name")}),(0,a.jsx)($,{type:"number",placeholder:"Payment",value:t.paymentPerVisit,onChange:e=>s(t.id,{paymentPerVisit:Number(e)}),onFocus:e=>e.target.select(),className:"w-24",schema:q,fieldName:"visit-".concat(t.id,"-payment"),showSuccess:!0})]})},X=E.k5(["flat","perPatient","perVisit"]),Z=e=>{let{item:t,onUpdate:s}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($,{type:"text",placeholder:"Description",value:t.name,onChange:e=>s(t.id,{name:e}),className:"flex-1",schema:W,fieldName:"customRevenue-".concat(t.id,"-name")}),(0,a.jsx)(J,{value:t.type,onChange:e=>s(t.id,{type:e}),options:[{value:"flat",label:"Flat"},{value:"perPatient",label:"Per Patient"},{value:"perVisit",label:"Per Visit"}],schema:X,fieldName:"customRevenue-".concat(t.id,"-type")}),(0,a.jsx)(J,{value:t.timing,onChange:e=>s(t.id,{timing:e,estimatedOccurrences:"asNeeded"===e?1:void 0}),options:[{value:"oneTime",label:"One-time"},{value:"perVisit",label:"Per Visit"},{value:"asNeeded",label:"As Needed"}],schema:Y,fieldName:"customRevenue-".concat(t.id,"-timing")}),"asNeeded"===t.timing&&(0,a.jsx)($,{type:"number",placeholder:"Occurrences",value:t.estimatedOccurrences||1,onChange:e=>s(t.id,{estimatedOccurrences:Number(e)}),onFocus:e=>e.target.select(),className:"w-20",schema:K,fieldName:"customRevenue-".concat(t.id,"-occurrences"),showSuccess:!0}),(0,a.jsx)($,{type:"number",placeholder:"Amount",value:t.amount,onChange:e=>s(t.id,{amount:Number(e)}),onFocus:e=>e.target.select(),className:"w-24",schema:q,fieldName:"customRevenue-".concat(t.id,"-amount"),showSuccess:!0}),(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat("oneTime"===t.timing?"bg-blue-100 text-blue-800":"perVisit"===t.timing?"bg-green-100 text-green-800":"bg-orange-100 text-orange-800"),children:"oneTime"===t.timing?"One-time":"perVisit"===t.timing?"Per Visit":"As Needed (".concat(t.estimatedOccurrences||1,"x)")})})]})},ee=E.k5(["perPatient","flatMonthly"]),et=E.ai().min(0).max(9999),es=E.ai().min(0).max(9999),ea=E.ai().min(0).max(999999),en=E.ai().min(0).max(999),er=e=>{var t,s,n,r;let{item:i,onUpdate:l}=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($,{type:"text",placeholder:"Role (e.g., Study Coordinator Fee)",value:i.role,onChange:e=>l(i.id,{role:e}),className:"flex-1",schema:W,fieldName:"personnel-".concat(i.id,"-role")}),(0,a.jsx)(J,{value:i.type,onChange:e=>l(i.id,{type:e,hourlyRate:"perPatient"===e?0:void 0,hours:"perPatient"===e?0:void 0,monthlyFee:"flatMonthly"===e?0:void 0,months:"flatMonthly"===e?0:void 0}),options:[{value:"perPatient",label:"Per Patient"},{value:"flatMonthly",label:"Monthly"}],schema:ee,fieldName:"personnel-".concat(i.id,"-type")}),"perPatient"===i.type?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($,{type:"number",placeholder:"Rate",value:null!=(t=i.hourlyRate)?t:"",onChange:e=>l(i.id,{hourlyRate:Number(e)}),onFocus:e=>e.target.select(),className:"w-20",schema:et,fieldName:"personnel-".concat(i.id,"-hourlyRate"),showSuccess:!0}),(0,a.jsx)($,{type:"number",placeholder:"Hours",value:null!=(s=i.hours)?s:"",onChange:e=>l(i.id,{hours:Number(e)}),onFocus:e=>e.target.select(),className:"w-20",schema:es,fieldName:"personnel-".concat(i.id,"-hours"),showSuccess:!0})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($,{type:"number",placeholder:"Monthly",value:null!=(n=i.monthlyFee)?n:"",onChange:e=>l(i.id,{monthlyFee:Number(e)}),onFocus:e=>e.target.select(),className:"w-24",schema:ea,fieldName:"personnel-".concat(i.id,"-monthlyFee"),showSuccess:!0}),(0,a.jsx)($,{type:"number",placeholder:"Months",value:null!=(r=i.months)?r:"",onChange:e=>l(i.id,{months:Number(e)}),onFocus:e=>e.target.select(),className:"w-20",schema:en,fieldName:"personnel-".concat(i.id,"-months"),showSuccess:!0})]})]})};var ei=s(5964),el=s.n(ei),eo=s(2502),em=s(4065),ec=s(4355);eo.t1.register(eo.Bs,eo.m_,eo.s$);let ed=e=>{let{startupFees:t,visitRevenue:s,customRevenue:n,personnelReimbursements:r}=e,i=t+s+n+r;if(0===i)return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,a.jsx)(ec.A,{className:"w-5 h-5 text-blue-700"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Budget Breakdown"})]}),(0,a.jsx)("div",{className:"flex items-center justify-center h-64 text-gray-500",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(ec.A,{className:"w-12 h-12 mx-auto mb-2 opacity-30"}),(0,a.jsx)("p",{className:"text-sm",children:"No budget data to display"}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Add budget items to see the breakdown"})]})})]});let l={labels:["Startup Fees","Visit Revenue","Custom Revenue","Personnel Reimbursements"].filter((e,a)=>[t,s,n,r][a]>0),datasets:[{data:[t,s,n,r].filter(e=>e>0),backgroundColor:["#3B82F6","#10B981","#F59E0B","#8B5CF6"],borderColor:["#2563EB","#059669","#D97706","#7C3AED"],borderWidth:2,hoverBorderWidth:3}]};return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,a.jsx)(ec.A,{className:"w-5 h-5 text-blue-700"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Budget Breakdown"})]}),(0,a.jsx)("div",{className:"relative h-64",children:(0,a.jsx)(em.Fq,{data:l,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0,font:{size:12}}},tooltip:{callbacks:{label:e=>{let t=e.parsed,s=(t/i*100).toFixed(1);return"".concat(e.label,": $").concat(t.toLocaleString()," (").concat(s,"%)")}}}}}})}),(0,a.jsx)("div",{className:"mt-4 grid grid-cols-2 gap-4 text-sm",children:l.labels.map((e,o)=>{let m=[t,s,n,r].filter(e=>e>0)[o],c=(m/i*100).toFixed(1);return(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:l.datasets[0].backgroundColor[o]}}),(0,a.jsx)("span",{className:"text-gray-700",children:e})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"font-semibold text-gray-900",children:["$",m.toLocaleString()]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:[c,"%"]})]})]},e)})})]})};var eu=s(2713);eo.t1.register(eo.PP,eo.kc,eo.FN,eo.No,eo.hE,eo.m_,eo.s$,eo.E8);let eg=e=>{let{totalRevenue:t,targetEnrollment:s,visitRevenue:r,customRevenue:i,personnelReimbursements:l}=e,[o,m]=(0,n.useState)("line");if(0===t||0===s)return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,a.jsx)(b.A,{className:"w-5 h-5 text-green-700"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Revenue Forecast"})]}),(0,a.jsx)("div",{className:"flex items-center justify-center h-64 text-gray-500",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(b.A,{className:"w-12 h-12 mx-auto mb-2 opacity-30"}),(0,a.jsx)("p",{className:"text-sm",children:"No enrollment target set"}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Set target enrollment to see forecast"})]})})]});let c=["Month 1","Month 2","Month 3","Month 4","Month 5","Month 6","Month 7","Month 8","Month 9","Month 10","Month 11","Month 12"],d=[.02,.05,.08,.12,.15,.18,.15,.12,.08,.03,.01,.01],u=0,g=c.map((e,t)=>{let a=Math.round(s*d[t]);u+=a;let n=a/s*r,o=a/s*i,m=a/s*l;return{month:c[t],enrollment:a,cumulativeEnrollment:u,visitRevenue:n,customRevenue:o,personnelCosts:m,totalRevenue:n+o+m}}),p={labels:c,datasets:[{label:"Monthly Revenue",data:g.map(e=>e.totalRevenue),borderColor:"#3B82F6",backgroundColor:"rgba(59, 130, 246, 0.1)",tension:.4,fill:"line"===o},{label:"Visit Revenue",data:g.map(e=>e.visitRevenue),borderColor:"#10B981",backgroundColor:"rgba(16, 185, 129, 0.5)",tension:.4,fill:!1},{label:"Personnel Costs",data:g.map(e=>e.personnelCosts),borderColor:"#8B5CF6",backgroundColor:"rgba(139, 92, 246, 0.5)",tension:.4,fill:!1}]},h="line"===o?em.N1:em.yP;return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,a.jsx)(b.A,{className:"w-5 h-5 text-green-700"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Revenue Forecast"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>m("line"),className:"p-2 rounded-lg transition-colors ".concat("line"===o?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"),title:"Line Chart",children:(0,a.jsx)(b.A,{className:"w-4 h-4"})}),(0,a.jsx)("button",{onClick:()=>m("bar"),className:"p-2 rounded-lg transition-colors ".concat("bar"===o?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"),title:"Bar Chart",children:(0,a.jsx)(eu.A,{className:"w-4 h-4"})})]})]}),(0,a.jsx)("div",{className:"relative h-64 mb-4",children:(0,a.jsx)(h,{data:p,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{padding:20,usePointStyle:!0,font:{size:12}}},tooltip:{callbacks:{label:e=>"".concat(e.dataset.label,": $").concat(e.parsed.y.toLocaleString()),afterBody:e=>{let t=g[e[0].dataIndex];return["Enrollment this month: ".concat(t.enrollment),"Cumulative enrollment: ".concat(t.cumulativeEnrollment)]}}}},scales:{y:{beginAtZero:!0,ticks:{callback:e=>"$".concat(e.toLocaleString())}}}}})}),(0,a.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,a.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg",children:[(0,a.jsx)("div",{className:"text-blue-700 font-semibold",children:"Peak Month"}),(0,a.jsxs)("div",{className:"text-blue-900",children:["Month ",g.findIndex(e=>e.totalRevenue===Math.max(...g.map(e=>e.totalRevenue)))+1]})]}),(0,a.jsxs)("div",{className:"bg-green-50 p-3 rounded-lg",children:[(0,a.jsx)("div",{className:"text-green-700 font-semibold",children:"Avg Monthly"}),(0,a.jsxs)("div",{className:"text-green-900",children:["$",Math.round(g.reduce((e,t)=>e+t.totalRevenue,0)/12).toLocaleString()]})]}),(0,a.jsxs)("div",{className:"bg-purple-50 p-3 rounded-lg",children:[(0,a.jsx)("div",{className:"text-purple-700 font-semibold",children:"Total Patients"}),(0,a.jsx)("div",{className:"text-purple-900",children:s})]}),(0,a.jsxs)("div",{className:"bg-amber-50 p-3 rounded-lg",children:[(0,a.jsx)("div",{className:"text-amber-700 font-semibold",children:"Study Duration"}),(0,a.jsx)("div",{className:"text-amber-900",children:"12 months"})]})]})]})};var ep=s(4416),eh=s(5196);let ex=[{id:"phase-1-oncology",name:"Phase I Oncology Study",description:"Template for early-phase oncology studies with dose escalation",category:"Phase I",isDefault:!0,createdAt:new Date().toISOString(),data:{targetEnrollment:30,overhead:25,startupFees:[{id:"1",name:"IRB Review Fee",amount:5e3,timing:"oneTime"},{id:"2",name:"Contract Negotiation",amount:3e3,timing:"oneTime"},{id:"3",name:"Site Initiation",amount:8e3,timing:"oneTime"},{id:"4",name:"Pharmacy Setup",amount:4e3,timing:"oneTime"}],visits:[{id:"1",name:"Screening Visit",paymentPerVisit:1200},{id:"2",name:"Cycle 1 Day 1",paymentPerVisit:1800},{id:"3",name:"Cycle 1 Day 15",paymentPerVisit:800},{id:"4",name:"End of Cycle Visits",paymentPerVisit:1e3},{id:"5",name:"End of Treatment",paymentPerVisit:1500}],customRevenueItems:[{id:"1",name:"SAE Reporting",amount:500,type:"perPatient",timing:"oneTime"},{id:"2",name:"Biomarker Analysis",amount:2e3,type:"perPatient",timing:"oneTime"}],personnelReimbursements:[{id:"1",role:"Study Coordinator",type:"perPatient",hourlyRate:65,hours:8},{id:"2",role:"Principal Investigator",type:"perPatient",hourlyRate:150,hours:2},{id:"3",role:"Pharmacist",type:"flatMonthly",monthlyFee:2e3,months:18}],notes:"Phase I oncology template with standard dose-escalation study components."}},{id:"phase-2-cardiology",name:"Phase II Cardiology Study",description:"Template for Phase II cardiovascular intervention studies",category:"Phase II",isDefault:!0,createdAt:new Date().toISOString(),data:{targetEnrollment:120,overhead:30,startupFees:[{id:"1",name:"IRB Review Fee",amount:6e3,timing:"oneTime"},{id:"2",name:"Site Qualification",amount:5e3,timing:"oneTime"},{id:"3",name:"Equipment Training",amount:4e3,timing:"oneTime"},{id:"4",name:"Central Lab Setup",amount:3500,timing:"oneTime"}],visits:[{id:"1",name:"Screening/Baseline",paymentPerVisit:1500},{id:"2",name:"Randomization",paymentPerVisit:800},{id:"3",name:"Week 4 Follow-up",paymentPerVisit:900},{id:"4",name:"Week 12 Follow-up",paymentPerVisit:1100},{id:"5",name:"Week 24 Follow-up",paymentPerVisit:1100},{id:"6",name:"Week 52 Follow-up",paymentPerVisit:1200}],customRevenueItems:[{id:"1",name:"Echocardiogram Reading",amount:300,type:"perPatient",timing:"oneTime"},{id:"2",name:"ECG Central Reading",amount:150,type:"perVisit",timing:"perVisit"},{id:"3",name:"Device Training",amount:8e3,type:"flat",timing:"oneTime"}],personnelReimbursements:[{id:"1",role:"Study Coordinator",type:"perPatient",hourlyRate:70,hours:6},{id:"2",role:"Principal Investigator",type:"perPatient",hourlyRate:200,hours:1.5},{id:"3",role:"Echo Technician",type:"perPatient",hourlyRate:80,hours:2},{id:"4",role:"Data Manager",type:"flatMonthly",monthlyFee:3e3,months:24}],notes:"Phase II cardiology template with imaging endpoints and device components."}},{id:"phase-3-diabetes",name:"Phase III Diabetes Study",description:"Template for large Phase III diabetes outcome studies",category:"Phase III",isDefault:!0,createdAt:new Date().toISOString(),data:{targetEnrollment:200,overhead:28,startupFees:[{id:"1",name:"IRB Review Fee",amount:8e3,timing:"oneTime"},{id:"2",name:"Site Initiation Visit",amount:12e3,timing:"oneTime"},{id:"3",name:"Lab Certification",amount:4e3,timing:"oneTime"},{id:"4",name:"Staff Training",amount:6e3,timing:"oneTime"}],visits:[{id:"1",name:"Screening Visit",paymentPerVisit:800},{id:"2",name:"Randomization Visit",paymentPerVisit:600},{id:"3",name:"Month 1 Visit",paymentPerVisit:400},{id:"4",name:"Month 3 Visit",paymentPerVisit:500},{id:"5",name:"Month 6 Visit",paymentPerVisit:500},{id:"6",name:"Month 12 Visit",paymentPerVisit:600},{id:"7",name:"Final Visit",paymentPerVisit:700}],customRevenueItems:[{id:"1",name:"HbA1c Testing",amount:50,type:"perVisit",timing:"perVisit"},{id:"2",name:"Glucose Monitoring",amount:200,type:"perPatient",timing:"oneTime"},{id:"3",name:"MACE Adjudication",amount:300,type:"perPatient",timing:"asNeeded",estimatedOccurrences:2}],personnelReimbursements:[{id:"1",role:"Study Coordinator",type:"perPatient",hourlyRate:75,hours:4},{id:"2",role:"Principal Investigator",type:"perPatient",hourlyRate:180,hours:1},{id:"3",role:"Sub-Investigator",type:"perPatient",hourlyRate:120,hours:.5},{id:"4",role:"CRA Support",type:"flatMonthly",monthlyFee:4e3,months:30}],notes:"Phase III diabetes template for cardiovascular outcome studies with long-term follow-up."}},{id:"observational",name:"Observational Registry Study",description:"Template for observational registry and real-world evidence studies",category:"Observational",isDefault:!0,createdAt:new Date().toISOString(),data:{targetEnrollment:300,overhead:20,startupFees:[{id:"1",name:"IRB Review Fee",amount:3e3,timing:"oneTime"},{id:"2",name:"Site Setup",amount:2500,timing:"oneTime"},{id:"3",name:"Database Access",amount:2e3,timing:"oneTime"}],visits:[{id:"1",name:"Enrollment Visit",paymentPerVisit:300},{id:"2",name:"6-Month Follow-up",paymentPerVisit:200},{id:"3",name:"12-Month Follow-up",paymentPerVisit:200}],customRevenueItems:[{id:"1",name:"Chart Review",amount:100,type:"perPatient",timing:"oneTime"},{id:"2",name:"Phone Follow-up",amount:50,type:"perPatient",timing:"asNeeded",estimatedOccurrences:3}],personnelReimbursements:[{id:"1",role:"Study Coordinator",type:"perPatient",hourlyRate:60,hours:2},{id:"2",role:"Principal Investigator",type:"perPatient",hourlyRate:150,hours:.5},{id:"3",role:"Data Entry",type:"flatMonthly",monthlyFee:1500,months:18}],notes:"Observational study template for registry and real-world evidence collection."}}],eb="ctaBudget_templates",ey=()=>{try{let e=localStorage.getItem(eb);if(e){let t=JSON.parse(e);return[...ex,...t]}return ex}catch(e){return console.error("Error loading templates:",e),ex}},ev=e=>{let{isOpen:t,onClose:s,onApplyTemplate:r,currentBudgetData:i}=e,[l,m]=(0,n.useState)([]),[c,d]=(0,n.useState)(!1),[u,g]=(0,n.useState)(""),[p,h]=(0,n.useState)(""),[x,b]=(0,n.useState)("Custom");(0,n.useEffect)(()=>{t&&m(ey())},[t]);let y={"Phase I":"bg-red-100 text-red-800","Phase II":"bg-yellow-100 text-yellow-800","Phase III":"bg-green-100 text-green-800",Observational:"bg-blue-100 text-blue-800",Device:"bg-purple-100 text-purple-800",Custom:"bg-gray-100 text-gray-800"};return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-4xl w-full mx-4 shadow-xl max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,a.jsx)(o.A,{className:"w-5 h-5 text-blue-700"})}),(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"Budget Templates"})]}),(0,a.jsx)("button",{onClick:s,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:(0,a.jsx)(ep.A,{className:"w-5 h-5"})})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("button",{onClick:()=>d(!c),className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:[(0,a.jsx)(C.A,{className:"w-4 h-4"}),"Save Current Budget as Template"]})}),c&&(0,a.jsxs)("div",{className:"mb-6 p-4 border border-gray-200 rounded-lg bg-gray-50",children:[(0,a.jsx)("h4",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New Template"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Template Name"}),(0,a.jsx)("input",{type:"text",value:u,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., My Phase II Study Template"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),(0,a.jsxs)("select",{value:x,onChange:e=>b(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,a.jsx)("option",{value:"Custom",children:"Custom"}),(0,a.jsx)("option",{value:"Phase I",children:"Phase I"}),(0,a.jsx)("option",{value:"Phase II",children:"Phase II"}),(0,a.jsx)("option",{value:"Phase III",children:"Phase III"}),(0,a.jsx)("option",{value:"Observational",children:"Observational"}),(0,a.jsx)("option",{value:"Device",children:"Device"})]})]})]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,a.jsx)("textarea",{value:p,onChange:e=>h(e.target.value),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Brief description of this template..."})]}),(0,a.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,a.jsxs)("button",{onClick:()=>{if(!u.trim())return;let{studyInfo:e,...t}=i;(e=>{try{let t=ey().filter(e=>!e.isDefault),s={...e,id:"custom-".concat(Date.now()),createdAt:new Date().toISOString(),isDefault:!1};t.push(s),localStorage.setItem(eb,JSON.stringify(t))}catch(e){console.error("Error saving template:",e)}})({name:u,description:p,category:x,data:t}),m(ey()),d(!1),g(""),h(""),b("Custom")},disabled:!u.trim(),className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-sm font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,a.jsx)(eh.A,{className:"w-4 h-4"}),"Save Template"]}),(0,a.jsx)("button",{onClick:()=>d(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-sm font-medium",children:"Cancel"})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:l.map(e=>(0,a.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900 text-sm",children:e.name}),(0,a.jsx)("span",{className:"inline-block px-2 py-1 rounded-full text-xs font-medium mt-1 ".concat(y[e.category]),children:e.category})]}),!e.isDefault&&(0,a.jsx)("button",{onClick:()=>{var t;return t=e.id,void(window.confirm("Are you sure you want to delete this template?")&&((e=>{try{let t=ey().filter(t=>!t.isDefault&&t.id!==e);localStorage.setItem(eb,JSON.stringify(t))}catch(e){console.error("Error deleting template:",e)}})(t),m(ey())))},className:"p-1 text-gray-400 hover:text-red-600 transition-colors",title:"Delete template",children:(0,a.jsx)(P.A,{className:"w-4 h-4"})})]}),(0,a.jsx)("p",{className:"text-gray-600 text-sm mb-4 line-clamp-2",children:e.description}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs text-gray-500 mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Enrollment:"})," ",e.data.targetEnrollment]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Overhead:"})," ",e.data.overhead,"%"]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Visits:"})," ",e.data.visits.length]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Personnel:"})," ",e.data.personnelReimbursements.length]})]}),(0,a.jsx)("button",{onClick:()=>{r(((e,t)=>{let s=ey().find(t=>t.id===e);return s?{...s.data,studyInfo:t.studyInfo}:(console.error("Template with id ".concat(e," not found")),t)})(e.id,i)),s()},className:"w-full px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium",children:"Apply Template"})]},e.id))}),0===l.length&&(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,a.jsx)(o.A,{className:"w-12 h-12 mx-auto mb-4 opacity-30"}),(0,a.jsx)("p",{children:"No templates available"})]})]})}):null};function ef(){let{budgetData:e,updateBudgetData:t,resetBudgetData:s,addStartupFee:I,updateStartupFee:C,deleteStartupFee:P,addVisit:E,updateVisit:A,deleteVisit:T,addCustomRevenueItem:k,updateCustomRevenueItem:D,deleteCustomRevenueItem:O,addPersonnelReimbursement:V,updatePersonnelReimbursement:M,deletePersonnelReimbursement:B}=(()=>{let[e,t]=(0,n.useState)(()=>{let{data:e}=w();return e}),[s,a]=(0,n.useState)(!1),[r,i]=(0,n.useState)(null),l=(0,n.useCallback)(el()(e=>{let t=(e=>{if(!N(e))return{success:!1,error:{type:"INVALID_DATA",message:"Budget data failed validation before saving"}};try{let t=JSON.stringify(e);if(t.length>5242880)return{success:!1,error:{type:"QUOTA_EXCEEDED",message:"Data is too large to store"}};let s=localStorage.getItem(y);if(s)try{localStorage.setItem(v,s)}catch(e){console.warn("Failed to create backup:",e)}return localStorage.setItem(y,t),{success:!0}}catch(t){if("QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)try{return localStorage.removeItem(v),localStorage.setItem(y,JSON.stringify(e)),{success:!0}}catch(e){return{success:!1,error:{type:"QUOTA_EXCEEDED",message:"Storage quota exceeded. Consider exporting your data.",originalError:t}}}return{success:!1,error:{type:"UNKNOWN",message:"Failed to save budget data",originalError:t}}}})(e);!t.success&&t.error?i(t.error):i(null)},500),[]);(0,n.useEffect)(()=>{a(!0);let{data:e,error:s}=w();t(e),s&&i(s)},[]),(0,n.useEffect)(()=>{s&&l(e)},[e,s,l]);let o=(0,n.useCallback)(e=>{t(t=>({...t,...e}))},[]),m=(0,n.useCallback)(()=>{t(f)},[]),c=(0,n.useCallback)(()=>{let t={id:Date.now().toString(),name:"New Startup Fee",amount:0,timing:"oneTime"};o({startupFees:[...e.startupFees,t]})},[e.startupFees,o]),d=(0,n.useCallback)((t,s)=>{o({startupFees:e.startupFees.map(e=>e.id===t?{...e,...s}:e)})},[e.startupFees,o]),u=(0,n.useCallback)(t=>{o({startupFees:e.startupFees.filter(e=>e.id!==t)})},[e.startupFees,o]),g=(0,n.useCallback)(()=>{let t={id:Date.now().toString(),name:"Visit ".concat(e.visits.length+1),paymentPerVisit:0};o({visits:[...e.visits,t]})},[e.visits,o]),p=(0,n.useCallback)((t,s)=>{o({visits:e.visits.map(e=>e.id===t?{...e,...s}:e)})},[e.visits,o]),h=(0,n.useCallback)(t=>{o({visits:e.visits.filter(e=>e.id!==t)})},[e.visits,o]),x=(0,n.useCallback)(()=>{let t={id:Date.now().toString(),name:"New Revenue Item",amount:0,type:"flat",timing:"oneTime"};o({customRevenueItems:[...e.customRevenueItems,t]})},[e.customRevenueItems,o]),b=(0,n.useCallback)((t,s)=>{o({customRevenueItems:e.customRevenueItems.map(e=>e.id===t?{...e,...s}:e)})},[e.customRevenueItems,o]),j=(0,n.useCallback)(t=>{o({customRevenueItems:e.customRevenueItems.filter(e=>e.id!==t)})},[e.customRevenueItems,o]),S=(0,n.useCallback)(()=>{let t={id:Date.now().toString(),role:"New Personnel Role",type:"perPatient",hourlyRate:0,hours:0};o({personnelReimbursements:[...e.personnelReimbursements,t]})},[e.personnelReimbursements,o]),I=(0,n.useCallback)((t,s)=>{o({personnelReimbursements:e.personnelReimbursements.map(e=>e.id===t?{...e,...s}:e)})},[e.personnelReimbursements,o]),R=(0,n.useCallback)(t=>{o({personnelReimbursements:e.personnelReimbursements.filter(e=>e.id!==t)})},[e.personnelReimbursements,o]);return{budgetData:e,updateBudgetData:o,resetBudgetData:m,isClient:s,storageError:r,addStartupFee:c,updateStartupFee:d,deleteStartupFee:u,addVisit:g,updateVisit:p,deleteVisit:h,addCustomRevenueItem:x,updateCustomRevenueItem:b,deleteCustomRevenueItem:j,addPersonnelReimbursement:S,updatePersonnelReimbursement:I,deletePersonnelReimbursement:R}})(),{totalStartupFees:L,totalVisitRevenue:_,totalCustomRevenue:U,totalPersonnelReimbursements:z,subtotal:$,overheadAmount:J,totalRevenue:W}=(0,n.useMemo)(()=>{let t=e.startupFees.reduce((t,s)=>{let a=s.amount;if("oneTime"===s.timing);else if("perVisit"===s.timing)return t+a*e.visits.length*e.targetEnrollment;else if("asNeeded"===s.timing)return t+a*(s.estimatedOccurrences||1);return t+a},0),s=e.visits.reduce((t,s)=>t+s.paymentPerVisit*e.targetEnrollment,0),a=e.customRevenueItems.reduce((t,s)=>{let a=0;if("flat"===s.type?a=s.amount:"perPatient"===s.type?a=s.amount*e.targetEnrollment:"perVisit"===s.type&&(a=s.amount*e.visits.length*e.targetEnrollment),"oneTime"===s.timing);else if("perVisit"===s.timing)return t+a*e.visits.length;else if("asNeeded"===s.timing)return t+a*(s.estimatedOccurrences||1);return t+a},0),n=e.personnelReimbursements.reduce((t,s)=>"perPatient"===s.type&&s.hourlyRate&&s.hours?t+s.hourlyRate*s.hours*e.targetEnrollment:"flatMonthly"===s.type&&s.monthlyFee&&s.months?t+s.monthlyFee*s.months:t,0),r=t+s+a+n,i=r*(e.overhead/100);return{totalStartupFees:t,totalVisitRevenue:s,totalCustomRevenue:a,totalPersonnelReimbursements:n,subtotal:r,overheadAmount:i,totalRevenue:r+i}},[e]),[q,Y]=(0,n.useState)(!1),[K,H]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=e=>{"Escape"===e.key&&(q&&Y(!1),K&&H(!1))};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[q,K]);let G=async e=>{var s;let a=null==(s=e.target.files)?void 0:s[0];if(a){let e=await new Promise(e=>{if(!a.name.toLowerCase().endsWith(".json"))return void e({data:f,error:{type:"INVALID_DATA",message:"Please select a valid JSON file"}});if(a.size>5242880)return void e({data:f,error:{type:"QUOTA_EXCEEDED",message:"File is too large to import"}});let t=new FileReader;t.onload=t=>{try{var s;let a,n=null==(s=t.target)?void 0:s.result;if("string"!=typeof n)return void e({data:f,error:{type:"INVALID_DATA",message:"Unable to read file contents"}});try{a=JSON.parse(n)}catch(t){e({data:f,error:{type:"PARSE_ERROR",message:"Invalid JSON format in file",originalError:t}});return}let r=(e=>{if(!e||"object"!=typeof e)return{};let t={...e};delete t.__proto__,delete t.constructor;let s=e=>{if(Array.isArray(e))return e.map(s);if(e&&"object"==typeof e){let t={};for(let[a,n]of Object.entries(e))t[a]=s(n);return t}return"string"==typeof e?(e=>"string"!=typeof e?"":e.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,""))(e):e};return s(t)})(a),i=j(r);if(!N(i))return void e({data:f,error:{type:"INVALID_DATA",message:"File does not contain valid budget data"}});e({data:i})}catch(t){e({data:f,error:{type:"UNKNOWN",message:"Unexpected error reading file",originalError:t}})}},t.onerror=()=>{e({data:f,error:{type:"UNKNOWN",message:"Failed to read file"}})},t.readAsText(a)});e.error?console.error("Import failed:",e.error.message):t(e.data)}},X=()=>{S(e)},Z=async()=>{await R(e,{totalStartupFees:L,totalVisitRevenue:_,totalCustomRevenue:U,totalPersonnelReimbursements:z,subtotal:$,overheadAmount:J,totalRevenue:W})},ee=async()=>{await F(e,{totalStartupFees:L,totalVisitRevenue:_,totalCustomRevenue:U,totalPersonnelReimbursements:z,subtotal:$,overheadAmount:J,totalRevenue:W})},{getShortcutText:et}=(e=>{let t=(0,n.useCallback)(t=>{if(t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement||t.target instanceof HTMLSelectElement)return;let s="undefined"!=typeof navigator&&navigator.platform.toUpperCase().indexOf("MAC")>=0?t.metaKey:t.ctrlKey;if(s){var a,n,r,i,l,o,m;switch(t.key.toLowerCase()){case"s":t.preventDefault(),null==(a=e.onSave)||a.call(e);break;case"p":t.preventDefault(),null==(n=e.onExportPDF)||n.call(e);break;case"e":t.preventDefault(),null==(r=e.onExportExcel)||r.call(e);break;case"j":t.preventDefault(),null==(i=e.onExportJSON)||i.call(e);break;case"t":t.preventDefault(),null==(l=e.onTemplates)||l.call(e);break;case"i":t.preventDefault(),null==(o=e.onImport)||o.call(e);break;case"r":t.shiftKey&&(t.preventDefault(),null==(m=e.onClearAll)||m.call(e))}}s||t.shiftKey||t.altKey||"?"!==t.key||t.preventDefault()},[e]);return(0,n.useEffect)(()=>(document.addEventListener("keydown",t),()=>{document.removeEventListener("keydown",t)}),[t]),{getShortcutText:(0,n.useCallback)(()=>{let e="undefined"!=typeof navigator&&navigator.platform.toUpperCase().indexOf("MAC")>=0?"âŒ˜":"Ctrl";return{save:"".concat(e,"+S"),exportPDF:"".concat(e,"+P"),exportExcel:"".concat(e,"+E"),exportJSON:"".concat(e,"+J"),templates:"".concat(e,"+T"),import:"".concat(e,"+I"),clearAll:"".concat(e,"+Shift+R")}},[])}})({onSave:X,onExportPDF:Z,onExportExcel:ee,onExportJSON:()=>S(e),onTemplates:()=>H(!0),onClearAll:()=>Y(!0),onImport:()=>{let e=document.getElementById("file-import");null==e||e.click()}}),es=et();return(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-4",children:(0,a.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-600 rounded-lg",children:(0,a.jsx)(r.A,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-900",children:"Clinical Trial Budget Forecaster"}),(0,a.jsx)("p",{className:"text-xs sm:text-sm text-gray-600",children:"Comprehensive clinical trial budget planning"})]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 overflow-x-auto",children:[(0,a.jsxs)("button",{onClick:()=>H(!0),className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors text-xs sm:text-sm font-medium whitespace-nowrap",title:"Templates (".concat(es.templates,")"),children:[(0,a.jsx)(i.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Templates"})]}),(0,a.jsxs)("button",{onClick:X,className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors text-xs sm:text-sm font-medium whitespace-nowrap",title:"Save Budget (".concat(es.save,")"),children:[(0,a.jsx)(l.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Save"})]}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsxs)("button",{onClick:Z,className:"flex items-center gap-1 px-2 sm:px-3 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors text-xs sm:text-sm font-medium border border-red-300 whitespace-nowrap",title:"Export PDF (".concat(es.exportPDF,")"),children:[(0,a.jsx)(o.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"PDF"})]}),(0,a.jsxs)("button",{onClick:ee,className:"flex items-center gap-1 px-2 sm:px-3 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors text-xs sm:text-sm font-medium border border-green-300 whitespace-nowrap",title:"Export Excel (".concat(es.exportExcel,")"),children:[(0,a.jsx)(m.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Excel"})]}),(0,a.jsxs)("button",{onClick:()=>S(e),className:"flex items-center gap-1 px-2 sm:px-3 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors text-xs sm:text-sm font-medium border border-gray-300 whitespace-nowrap",title:"Export JSON (".concat(es.exportJSON,")"),children:[(0,a.jsx)(c.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"JSON"})]})]}),(0,a.jsxs)("label",{className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-xs sm:text-sm font-medium cursor-pointer whitespace-nowrap",title:"Import (".concat(es.import,")"),children:[(0,a.jsx)(d.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Import"}),(0,a.jsx)("input",{id:"file-import",type:"file",accept:".json",onChange:G,className:"hidden"})]}),(0,a.jsxs)("button",{onClick:()=>{Y(!0)},className:"flex items-center gap-1 sm:gap-2 px-2 sm:px-3 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors text-xs sm:text-sm font-medium border border-red-300 whitespace-nowrap",title:"Clear All (".concat(es.clearAll,")"),children:[(0,a.jsx)(u.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"Clear"})]})]})]})})}),(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 py-6 sm:py-8",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 lg:gap-8",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-6 lg:space-y-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4 sm:mb-6",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,a.jsx)(g.A,{className:"w-5 h-5 text-blue-700"})}),(0,a.jsx)("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:"Study Information"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Protocol Number"}),(0,a.jsx)("input",{type:"text",value:e.studyInfo.protocolNumber,onChange:s=>t({studyInfo:{...e.studyInfo,protocolNumber:s.target.value}}),className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900",placeholder:"e.g., PROTO-2024-001"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Study Title"}),(0,a.jsx)("input",{type:"text",value:e.studyInfo.studyTitle,onChange:s=>t({studyInfo:{...e.studyInfo,studyTitle:s.target.value}}),className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900",placeholder:"Study title"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Principal Investigator"}),(0,a.jsx)("input",{type:"text",value:e.studyInfo.piName,onChange:s=>t({studyInfo:{...e.studyInfo,piName:s.target.value}}),className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900",placeholder:"PI Name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Study Date"}),(0,a.jsx)("input",{type:"date",value:e.studyInfo.studyDate,onChange:s=>t({studyInfo:{...e.studyInfo,studyDate:s.target.value}}),className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sponsor"}),(0,a.jsx)("input",{type:"text",value:e.studyInfo.sponsor,onChange:s=>t({studyInfo:{...e.studyInfo,sponsor:s.target.value}}),className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900",placeholder:"Sponsor name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Site Name"}),(0,a.jsx)("input",{type:"text",value:e.studyInfo.siteName,onChange:s=>t({studyInfo:{...e.studyInfo,siteName:s.target.value}}),className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900",placeholder:"Site name"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4 sm:mb-6",children:[(0,a.jsx)("div",{className:"p-2 bg-gray-100 rounded-lg",children:(0,a.jsx)(p.A,{className:"w-5 h-5 text-gray-700"})}),(0,a.jsx)("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:"Study Parameters"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Target Enrollment"}),(0,a.jsx)("input",{type:"number",value:e.targetEnrollment,onChange:e=>{let s=""===e.target.value?0:parseInt(e.target.value,10);t({targetEnrollment:isNaN(s)?0:s})},onFocus:e=>e.target.select(),className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900",placeholder:"Number of patients",min:"1"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Overhead Rate (%)"}),(0,a.jsx)("input",{type:"number",value:e.overhead,onChange:e=>t({overhead:Number(e.target.value)}),onFocus:e=>e.target.select(),className:"w-full px-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900",placeholder:"Overhead %",min:"0",step:"0.1"})]})]})]}),(0,a.jsx)(Q,{title:"Startup Fees",category:"startupFees",items:e.startupFees,onAdd:I,onUpdate:C,onDelete:P,icon:h.A}),(0,a.jsx)(Q,{title:"Visit Schedule",category:"visits",items:e.visits,onAdd:E,onUpdate:A,onDelete:T,icon:x.A}),(0,a.jsx)(Q,{title:"Custom Revenue Items",category:"customRevenue",items:e.customRevenueItems,onAdd:k,onUpdate:D,onDelete:O,icon:b.A}),(0,a.jsx)(Q,{title:"Personnel Reimbursement Requests",category:"personnelReimbursements",items:e.personnelReimbursements,onAdd:V,onUpdate:M,onDelete:B,icon:p.A}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("div",{className:"p-2 bg-gray-100 rounded-lg",children:(0,a.jsx)(o.A,{className:"w-5 h-5 text-gray-700"})}),(0,a.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-gray-900",children:"Notes"})]}),(0,a.jsx)("textarea",{value:e.notes,onChange:e=>t({notes:e.target.value}),placeholder:"Add any additional notes or comments here...",className:"w-full h-32 px-4 py-3 bg-white border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900 resize-none"})]})]}),(0,a.jsxs)("div",{className:"space-y-4 lg:space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6 lg:sticky lg:top-24",children:[(0,a.jsx)("h3",{className:"text-lg sm:text-xl font-semibold text-gray-900 mb-4 sm:mb-6",children:"Budget Summary"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Startup Fees"}),(0,a.jsxs)("span",{className:"font-semibold text-gray-900",children:["$",L.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Visit Revenue"}),(0,a.jsxs)("span",{className:"font-semibold text-gray-900",children:["$",_.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Custom Revenue"}),(0,a.jsxs)("span",{className:"font-semibold text-gray-900",children:["$",U.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Personnel Reimbursements"}),(0,a.jsxs)("span",{className:"font-semibold text-gray-900",children:["$",z.toLocaleString()]})]}),(0,a.jsx)("hr",{className:"border-gray-200"}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Subtotal"}),(0,a.jsxs)("span",{className:"font-semibold text-gray-900",children:["$",$.toLocaleString()]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("span",{className:"text-gray-600",children:["Overhead (",e.overhead,"%)"]}),(0,a.jsxs)("span",{className:"font-semibold text-gray-900",children:["$",J.toLocaleString()]})]}),(0,a.jsx)("hr",{className:"border-gray-200"}),(0,a.jsxs)("div",{className:"flex justify-between items-center text-lg bg-blue-50 p-3 rounded-lg",children:[(0,a.jsx)("span",{className:"font-semibold text-gray-900",children:"Total Budget Request"}),(0,a.jsxs)("span",{className:"font-bold text-gray-900",children:["$",W.toLocaleString()]})]}),e.targetEnrollment>0&&(0,a.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Budget Per Patient"}),(0,a.jsxs)("span",{className:"font-semibold text-gray-900",children:["$",(W/e.targetEnrollment).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})]})})]})]}),(0,a.jsx)(ed,{startupFees:L,visitRevenue:_,customRevenue:U,personnelReimbursements:z}),(0,a.jsx)(eg,{totalRevenue:W,targetEnrollment:e.targetEnrollment,visitRevenue:_,customRevenue:U,personnelReimbursements:z}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-4 sm:p-6",children:[(0,a.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-4",children:"Quick Stats"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Protocol"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.studyInfo.protocolNumber||"Not set"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Total Line Items"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.visits.length+e.customRevenueItems.length+e.personnelReimbursements.length+e.startupFees.length})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Visits"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.visits.length})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Target Patients"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.targetEnrollment})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Personnel Items"}),(0,a.jsx)("span",{className:"font-medium text-gray-900",children:e.personnelReimbursements.length})]})]})]})]})]})}),q&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4 shadow-xl",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,a.jsx)("div",{className:"p-2 bg-red-100 rounded-lg",children:(0,a.jsx)(u.A,{className:"w-5 h-5 text-red-600"})}),(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Clear All Budget Data"})]}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Are you sure you want to clear all budget data? This will delete all study information, cost items, and reset everything to the initial state. This action cannot be undone."}),(0,a.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,a.jsx)("button",{onClick:()=>{Y(!1)},className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors text-sm font-medium",children:"Cancel"}),(0,a.jsx)("button",{onClick:()=>{s(),Y(!1)},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium",children:"Clear All Data"})]})]})}),(0,a.jsx)(ev,{isOpen:K,onClose:()=>H(!1),onApplyTemplate:t,currentBudgetData:e})]})}},8619:(e,t,s)=>{Promise.resolve().then(s.bind(s,5016))}},e=>{e.O(0,[647,930,316,644,441,964,358],()=>e(e.s=8619)),_N_E=e.O()}]);